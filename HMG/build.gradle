import org.gradle.plugins.ide.eclipse.model.internal.FileReferenceFactory

project.version = "Overdrive2.7"

// A little hack to fix codechicken's crazy maven structure (at least in 1.7.10)
eclipse.classpath.file.whenMerged { cp ->
	// Find all codechicken source jars
	def srcent = cp.entries.findAll { entry -> entry.path.contains("codechicken") && entry.path.endsWith("-src.jar") }

	// Remove them from classpath
	cp.entries.removeAll srcent

	// Map the source entries to their dev counterparts based on basename
	Map<String, File> srcmap = new HashMap<String, File>()
	srcent.forEach { entry ->
		def file = new File(entry.path)
		srcmap.put(file.getName().replace("-src.jar", "-dev.jar"), file)
	}

	// Create file reference factory
	def fileref = new FileReferenceFactory()

	// Find all codechicken development jars
	cp.entries.findAll { entry -> entry.path.contains("codechicken") && entry.path.endsWith("-dev.jar") }.forEach { entry ->
		File srcmapping = new File(entry.path) // Initialize the srcmapping from the dev jar path
		srcmapping = srcmap.get(srcmapping.getName()) // Transform it using the sourcemap
		entry.sourcePath = fileref.fromFile(srcmapping) // Set the source path
	}
}

repositories {
	maven {
		name = 'ModMaven'
		url = 'https://modmaven.dev'
	}
	maven {
		name = "gt"
		url = "https://gregtech.mechaenetia.com/"
	}
	//maven {
	//	name = "CurseForge"
	//	url = "https://minecraft.curseforge.com/api/maven/"
	//}
}

dependencies {
	implementation 'codechicken:CodeChickenCore:1.7.10-1.0.4.29:dev'
	compileOnly 'codechicken:CodeChickenCore:1.7.10-1.0.4.29:src'

	implementation 'codechicken:CodeChickenLib:1.7.10-1.1.3.140:dev'
	compileOnly 'codechicken:CodeChickenLib:1.7.10-1.1.3.140:src'

	implementation 'codechicken:NotEnoughItems:1.7.10-1.0.3.74:dev'
	compileOnly 'codechicken:NotEnoughItems:1.7.10-1.0.3.74:src'

	compileOnly "inventorytweaks:InventoryTweaks:1.59-dev:deobf"

	implementation "li.cil.oc:OpenComputers:MC1.7.10-1.5.+:api"
}

tasks.withType(Jar) {
    compileJava.options.encoding = 'UTF-8'
    compileApiJava.options.encoding = 'UTF-8'
}
dependencies {
    compile project(':depend')
    compile fileTree(dir: 'lib', include: '*.jar')
    compile 'javax.vecmath:vecmath:1.5.2'
}

tasks.withType(JavaExec) {
	if (it.name == "runClient") {
		it.jvmArgs "-Djinput.useDefaultPlugin=false"
		it.jvmArgs "-Djinput.plugins=none"
		it.jvmArgs "-Djinput.loglevel=OFF"
	}
}